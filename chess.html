<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chess AI</title>
<style>
body{
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  background:#222;
  font-family:Arial;
  margin:0;
}

#board{
  display:grid;
  grid-template-columns:repeat(8,70px);
  grid-template-rows:repeat(8,70px);
  border:4px solid #333;
}

.square{
  width:70px;
  height:70px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:50px; /* bigger pieces */
  cursor:pointer;
  transition: background 0.2s;
}

.white{ background:#f0d9b5; }       /* light square */
.black{ background:#b58863; }       /* dark square */
.selected{ outline:4px solid red; }

/* Piece colors */
.white-piece{ color:#fff; }  /* pure white */
.black-piece{ color:#000; }  /* pure black */
</style>
</head>
<body>

<div id="board"></div>

<script>
// ---------------- PIECES ----------------
const pieces={
"r":"♜","n":"♞","b":"♝","q":"♛","k":"♚","p":"♟",
"R":"♖","N":"♘","B":"♗","Q":"♕","K":"♔","P":"♙"
};

// ---------------- BOARD ----------------
let board=[
["r","n","b","q","k","b","n","r"],
["p","p","p","p","p","p","p","p"],
["","","","","","","",""],
["","","","","","","",""],
["","","","","","","",""],
["","","","","","","",""],
["P","P","P","P","P","P","P","P"],
["R","N","B","Q","K","B","N","R"]
];

let selected=null;
let playerTurn=true;

// ---------------- DRAW ----------------
function drawBoard(){
  let b=document.getElementById("board");
  b.innerHTML="";
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      let s=document.createElement("div");
      s.className="square "+((r+c)%2==0?"white":"black");
      if(selected && selected[0]==r && selected[1]==c)
        s.classList.add("selected");

      if(board[r][c]){
        s.textContent=pieces[board[r][c]];
        s.classList.add(board[r][c]===board[r][c].toUpperCase() ? "white-piece" : "black-piece");
      }

      s.onclick=()=>clickSquare(r,c);
      b.appendChild(s);
    }
  }
}
drawBoard();

// ---------------- CLICK ----------------
function clickSquare(r,c){
  if(!playerTurn) return;

  if(selected){
    if(isValidMove(selected[0],selected[1],r,c)){
      movePiece(selected[0],selected[1],r,c);
      selected=null;
      playerTurn=false;
      drawBoard();
      setTimeout(aiMove,50); // AI fast
    }else{
      selected=null;
    }
  }else{
    if(board[r][c] && board[r][c]==board[r][c].toUpperCase()){
      selected=[r,c];
    }
  }
  drawBoard();
}

// ---------------- MOVE ----------------
function movePiece(fr,fc,tr,tc){
  board[tr][tc]=board[fr][fc];
  board[fr][fc]="";
}

// ---------------- VALID MOVE ----------------
function isValidMove(fr,fc,tr,tc){
  let p=board[fr][fc];
  let dr=tr-fr, dc=tc-fc;

  if(board[tr][tc] && sameColor(p,board[tr][tc])) return false;

  switch(p.toLowerCase()){
    case "p":
      if(p=="P"){
        if(dc==0 && dr==-1 && !board[tr][tc]) return true;
        if(fc==tc && fr==6 && dr==-2 && !board[5][fc]) return true;
        if(Math.abs(dc)==1 && dr==-1 && board[tr][tc]) return true;
      }else{
        if(dc==0 && dr==1 && !board[tr][tc]) return true;
        if(fr==1 && dr==2 && !board[2][fc]) return true;
        if(Math.abs(dc)==1 && dr==1 && board[tr][tc]) return true;
      }
      break;

    case "r": return clear(fr,fc,tr,tc);
    case "b": return Math.abs(dr)==Math.abs(dc)&&clear(fr,fc,tr,tc);
    case "q": return (dr==0||dc==0||Math.abs(dr)==Math.abs(dc)) && clear(fr,fc,tr,tc);
    case "n": return (Math.abs(dr)==2&&Math.abs(dc)==1)||(Math.abs(dr)==1&&Math.abs(dc)==2);
    case "k": return Math.abs(dr)<=1 && Math.abs(dc)<=1;
  }
  return false;
}

// ---------------- PATH CLEAR ----------------
function clear(fr,fc,tr,tc){
  let rStep=Math.sign(tr-fr);
  let cStep=Math.sign(tc-fc);
  let r=fr+rStep, c=fc+cStep;
  while(r!=tr||c!=tc){
    if(board[r][c]) return false;
    r+=rStep; c+=cStep;
  }
  return true;
}

function sameColor(a,b){
  return (a==a.toUpperCase())==(b==b.toUpperCase());
}

// ---------------- AI ----------------
function aiMove(){
  let bestScore=-9999;
  let bestMove=null;

  forEachMove(false,(fr,fc,tr,tc)=>{
    let backup=board[tr][tc];
    movePiece(fr,fc,tr,tc);
    let score=minimax(2,false); // depth 2 for speed
    board[fr][fc]=board[tr][tc];
    board[tr][tc]=backup;
    if(score>bestScore){
      bestScore=score;
      bestMove=[fr,fc,tr,tc];
    }
  });

  if(bestMove) movePiece(...bestMove);

  playerTurn=true;
  drawBoard();
}

// ---------------- MINIMAX ----------------
function minimax(depth,isMax){
  if(depth==0) return evaluate();

  if(isMax){
    let max=-9999;
    forEachMove(false,(fr,fc,tr,tc)=>{
      let cap=board[tr][tc];
      movePiece(fr,fc,tr,tc);
      max=Math.max(max,minimax(depth-1,false));
      board[fr][fc]=board[tr][tc];
      board[tr][tc]=cap;
    });
    return max;
  }else{
    let min=9999;
    forEachMove(true,(fr,fc,tr,tc)=>{
      let cap=board[tr][tc];
      movePiece(fr,fc,tr,tc);
      min=Math.min(min,minimax(depth-1,true));
      board[fr][fc]=board[tr][tc];
      board[tr][tc]=cap;
    });
    return min;
  }
}

// ---------------- LOOP MOVES ----------------
function forEachMove(white,cb){
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      if(board[r][c] && (board[r][c]==(white?board[r][c].toUpperCase():board[r][c].toLowerCase()))){
        for(let tr=0;tr<8;tr++)
          for(let tc=0;tc<8;tc++)
            if(isValidMove(r,c,tr,tc)) cb(r,c,tr,tc);
      }
    }
  }
}

// ---------------- EVALUATION ----------------
function evaluate(){
  let score=0;
  const values={p:10,n:30,b:30,r:50,q:90,k:900};
  for(let r=0;r<8;r++)
    for(let c=0;c<8;c++){
      let p=board[r][c];
      if(p){
        let v=values[p.toLowerCase()];
        score += (p==p.toLowerCase()?v:-v);
      }
    }
  return score;
}
</script>

</body>
</html>
